<ion-header class="ion-no-border">
  <ion-toolbar color="secondary" class="header-toolbar">
    <ion-title class="header-title">Inicio</ion-title>
    <ion-buttons slot="end">
      <ion-button id="options-menu" fill="clear" class="settings-button" title="Opciones">
        <ion-icon name="ellipsis-vertical-outline"></ion-icon>
      </ion-button>
      <ion-popover trigger="options-menu" triggerAction="click" showBackdrop="true">
        <ng-template>
          <ion-content>
            <ion-list lines="none">
              <ion-item-divider>
                <ion-label>Acciones Disponibles</ion-label>
              </ion-item-divider>
              <ion-item button detail="false" (click)="goToUsersManagement()">
                <ion-icon name="person-add-outline" slot="start" color="primary"></ion-icon>
                <ion-label>
                  <h3>Asignar Usuario</h3>
                  <p>Agregar usuario a un grupo</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-content>
        </ng-template>
      </ion-popover>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="home-content">
  <div class="content-container">
    <div class="welcome-card">
      @defer (when userData$()) {
      <div class="user-info">
        <div class="avatar-section">
          <ion-icon name="person-circle" class="user-avatar"></ion-icon>
        </div>
        <div class="user-details">
          <p class="greeting-text">Bienvenido</p>
          <h2 class="username">{{ userData$()?.username }}</h2>
          <p class="user-role">{{ userData$()?.role }}</p>
        </div>
      </div>
      @if (userCanViewStats) {
      <div class="stats-button-container">
        <ion-button color="light" fill="outline" expand="block" class="stats-button" (click)="onViewStatistics()">
          <ion-icon name="stats-chart-outline" slot="start"></ion-icon>
          Ver Estadísticas
        </ion-button>
      </div>
      }
      }
      @placeholder {
      <div class="user-info">
        <div class="avatar-section">
          <ion-skeleton-text animated class="skeleton-avatar"></ion-skeleton-text>
        </div>
        <div class="user-details">
          <ion-skeleton-text animated style="width: 60%; height: 20px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 80%; height: 24px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 40%; height: 16px;"></ion-skeleton-text>
        </div>
      </div>
      }
    </div>

    <div class="groups-section">
      <div class="section-header">
        <ion-icon name="people-outline" class="section-icon"></ion-icon>
        <h3 class="section-title">Grupos Asignados</h3>
      </div>

      <div class="groups-container">
        @defer (on timer(3000)) {
        @for(group of groups$(); track group.id) {
        <div class="group-card">
          <div class="group-info">
            <div class="group-header">
              <ion-icon name="people-circle-outline" class="group-icon"></ion-icon>
              <div class="group-details">
                <h2 class="group-name">{{ group.name }}</h2>
                <p class="group-city">
                  <ion-icon name="location-outline" class="location-icon"></ion-icon>
                  {{ group.city }}
                </p>
              </div>
            </div>
          </div>
          <div class="group-actions">
            <ion-button fill="clear" size="small" class="action-button" (click)="onViewGroupDetail(group)">
              <ion-icon name="eye-outline" class="action-icon"></ion-icon>
            </ion-button>
          </div>
        </div>
        }
        }
        @placeholder {
        <div class="group-card skeleton-card">
          <div class="group-info">
            <div class="group-header">
              <ion-skeleton-text animated class="skeleton-group-icon"></ion-skeleton-text>
              <div class="group-details">
                <ion-skeleton-text animated style="width: 70%; height: 20px; margin-bottom: 8px;"></ion-skeleton-text>
                <ion-skeleton-text animated style="width: 50%; height: 16px;"></ion-skeleton-text>
              </div>
            </div>
          </div>
          <div class="group-actions">
            <ion-skeleton-text animated style="width: 32px; height: 32px; border-radius: 50%;"></ion-skeleton-text>
          </div>
        </div>
        }
        @error {
        <div class="error-card">
          <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
          <p class="error-text">Error al cargar los grupos. Inténtalo de nuevo más tarde.</p>
        </div>
        }
      </div>
    </div>
  </div>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="fab-container" style="bottom: 80px;">
    <ion-fab-button color="primary" class="main-fab">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <ion-fab-button color="success" class="sub-fab" (click)="onCreateUser()" [title]="'Grupo'">
        <ion-icon name="person-add"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="primary" class="sub-fab" (click)="onCreateGroup()" [title]="'Usuario'">
        <ion-icon name="people"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>

</ion-content>